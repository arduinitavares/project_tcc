<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Compiled Authority  Product 4</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    h1, h2 { color: #1f2d3d; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 24px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f2f2f2; }
    code { background: #f6f8fa; padding: 2px 4px; border-radius: 4px; }
    .section { margin-bottom: 24px; }
  </style>
</head>
<body>
  <h1>Compiled Authority  Product 4</h1>
  <p><strong>Product:</strong> Intelligent Camera System for Counting and Operational Compliance in a Sports Arena (ID: 4)</p>
  <div class="section">
    <h2>Spec Version</h2>
    <table>
      <tr><th>Spec Version ID</th><th>Status</th><th>Spec Hash</th><th>Approved At</th></tr>
      <tr><td>6</td><td>approved</td><td><code>425dc04da32548a6dc1628397e855e625119c3e3670d2a1852680a99c8cd4070</code></td><td>2026-02-03 01:56:34.258025</td></tr>
    </table>
  </div>
  <div class="section">
    <h2>Compiled Authority</h2>
    <table>
      <tr><th>Authority ID</th><th>Compiler Version</th><th>Prompt Hash</th><th>Compiled At</th></tr>
      <tr><td>5</td><td>1.0.0</td><td><code>ae3112c02fa6b97cbb22cbae0a2e15dde149a57da8c51778bd23f341b3755637</code></td><td>2026-02-03 01:57:16.511066</td></tr>
    </table>
  </div>
  <div class="section">
    <h2>Scope Themes</h2>
    <ul>
      <li>people counting</li>
      <li>operational compliance</li>
      <li>scheduling integration</li>
      <li>enrollment integration</li>
      <li>court reassignment</li>
      <li>computer vision</li>
      <li>notifications</li>
    </ul>
  </div>
  <div class="section">
    <h2>Invariants (used by story checks)</h2>
    <ul>
      <li><code>FORBIDDEN_CAPABILITY:FACIAL_RECOGNITION</code></li>
      <li><code>FORBIDDEN_CAPABILITY:INDIVIDUAL_IDENTIFICATION</code></li>
      <li><code>REQUIRED_FIELD:booking.is_internal</code></li>
      <li><code>REQUIRED_FIELD:students.student_id</code></li>
      <li><code>REQUIRED_FIELD:classes.class_id</code></li>
      <li><code>REQUIRED_FIELD:enrollments.active</code></li>
      <li><code>REQUIRED_FIELD:court.polygon</code></li>
      <li><code>REQUIRED_FIELD:entrance.virtual_lines</code></li>
      <li><code>MAX_VALUE:per_court_update_latency_seconds<= 5</code></li>
      <li><code>MAX_VALUE:persist_seconds<= 45</code></li>
      <li><code>MAX_VALUE:cooldown_minutes<= 5</code></li>
      <li><code>REQUIRED_FIELD:whatsapp.recipient_number</code></li>
    </ul>
  </div>
  <div class="section">
    <h2>Spec Gaps</h2>
    <ul>
      <li><em>None</em></li>
    </ul>
  </div>
  <div class="section">
    <h2>Compiled Artifact (JSON)</h2>
    <pre>
{
  "scope_themes": [
    "people counting",
    "operational compliance",
    "scheduling integration",
    "enrollment integration",
    "court reassignment",
    "computer vision",
    "notifications"
  ],
  "domain": "sports_facility_management",
  "invariants": [
    {
      "id": "INV-a1024512984bc7e4",
      "type": "FORBIDDEN_CAPABILITY",
      "parameters": {
        "capability": "FACIAL_RECOGNITION"
      }
    },
    {
      "id": "INV-bcf55d3087be9a03",
      "type": "FORBIDDEN_CAPABILITY",
      "parameters": {
        "capability": "INDIVIDUAL_IDENTIFICATION"
      }
    },
    {
      "id": "INV-e7cc1a9d239147a4",
      "type": "REQUIRED_FIELD",
      "parameters": {
        "field_name": "booking.is_internal"
      }
    },
    {
      "id": "INV-33b3515c29d0154f",
      "type": "REQUIRED_FIELD",
      "parameters": {
        "field_name": "students.student_id"
      }
    },
    {
      "id": "INV-c9c3e7b2c8cf403b",
      "type": "REQUIRED_FIELD",
      "parameters": {
        "field_name": "classes.class_id"
      }
    },
    {
      "id": "INV-d5b89a7d8bbb4f43",
      "type": "REQUIRED_FIELD",
      "parameters": {
        "field_name": "enrollments.active"
      }
    },
    {
      "id": "INV-7d39c58d7fc3be07",
      "type": "REQUIRED_FIELD",
      "parameters": {
        "field_name": "court.polygon"
      }
    },
    {
      "id": "INV-c379ee0c2d59a212",
      "type": "REQUIRED_FIELD",
      "parameters": {
        "field_name": "entrance.virtual_lines"
      }
    },
    {
      "id": "INV-9811a9850f778aa7",
      "type": "MAX_VALUE",
      "parameters": {
        "field_name": "per_court_update_latency_seconds",
        "max_value": 5
      }
    },
    {
      "id": "INV-a2359cd22f2853cd",
      "type": "MAX_VALUE",
      "parameters": {
        "field_name": "persist_seconds",
        "max_value": 45
      }
    },
    {
      "id": "INV-a2359cd22f2853cd",
      "type": "MAX_VALUE",
      "parameters": {
        "field_name": "cooldown_minutes",
        "max_value": 5
      }
    },
    {
      "id": "INV-5aa4c47fb741d189",
      "type": "REQUIRED_FIELD",
      "parameters": {
        "field_name": "whatsapp.recipient_number"
      }
    }
  ],
  "eligible_feature_rules": [],
  "gaps": [],
  "assumptions": [],
  "source_map": [
    {
      "invariant_id": "INV-a1024512984bc7e4",
      "excerpt": "- No facial recognition",
      "location": "Section 14"
    },
    {
      "invariant_id": "INV-bcf55d3087be9a03",
      "excerpt": "- No individual identification",
      "location": "Section 14"
    },
    {
      "invariant_id": "INV-e7cc1a9d239147a4",
      "excerpt": "- PDV Pix is the source of **bookings/schedules**.\n- Each booking has a boolean field:\n  - `is_internal = true` → Instructor-led class\n  - `is_internal = false` → Rental",
      "location": "Section 3.2"
    },
    {
      "invariant_id": "INV-33b3515c29d0154f",
      "excerpt": "| student_id | Unique identifier |",
      "location": "Section 5 — Sheet: `students`"
    },
    {
      "invariant_id": "INV-c9c3e7b2c8cf403b",
      "excerpt": "| class_id | Class identifier |",
      "location": "Section 5 — Sheet: `classes`"
    },
    {
      "invariant_id": "INV-d5b89a7d8bbb4f43",
      "excerpt": "| active | TRUE / FALSE |",
      "location": "Section 5 — Sheet: `enrollments`"
    },
    {
      "invariant_id": "INV-7d39c58d7fc3be07",
      "excerpt": "- One polygon per court.",
      "location": "Section 9 — Computer Vision"
    },
    {
      "invariant_id": "INV-c379ee0c2d59a212",
      "excerpt": "- Virtual IN/OUT lines.",
      "location": "Section 9 — Computer Vision"
    },
    {
      "invariant_id": "INV-9811a9850f778aa7",
      "excerpt": "1. Per-court counting with update ≤ 5s.",
      "location": "Section 13 — Acceptance Criteria"
    },
    {
      "invariant_id": "INV-a2359cd22f2853cd",
      "excerpt": "### Global parameters\n- `persist_seconds = 45`\n- `cooldown_minutes = 5`",
      "location": "Section 7 — Compliance Rules"
    },
    {
      "invariant_id": "INV-a2359cd22f2853cd",
      "excerpt": "### Global parameters\n- `persist_seconds = 45`\n- `cooldown_minutes = 5`",
      "location": "Section 7 — Compliance Rules"
    },
    {
      "invariant_id": "INV-5aa4c47fb741d189",
      "excerpt": "- Single recipient (fixed WhatsApp number of the arena).",
      "location": "Section 10 — Notifications"
    }
  ],
  "compiler_version": "1.0.0",
  "prompt_hash": "ae3112c02fa6b97cbb22cbae0a2e15dde149a57da8c51778bd23f341b3755637"
}
    </pre>
  </div>
</body>
</html>